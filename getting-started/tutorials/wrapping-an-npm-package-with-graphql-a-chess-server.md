---
description: 'Let''s have fun : create a GraphQL chess server !'
---

# Wrapping an NPM package with GraphQL: a chess server

In some projects, you'll need to include some NPM packages and run them as a service. Let's take an example and create a chess server using [chess.js](https://github.com/jhlywa/chess.js/blob/master/README.md)

We consider that you're familiar with **code.store** CLI, you have an account and you know how to create a new service. If not, follow our [quick start guide](../quick-start/quick-start-with-cli.md). 

## Step 1: Create a new service

Check that you're authenticated :

```scheme
cs whoami
```

If you receive following error message, that means you're not authenticated and you'll need to execute `codestore auth:login` command.

```text
Seems that you're not logged in. Please execute  codestore login  command to sign-in again.
```

Let's create a new service :

```text
cs service:create

 What is your service name?
 It should be the shortest meaningful name possible, for example:
        Meeting-rooms booking
 Service name: Chess Server

 Describe what functional problem are you solving with your service?
 It's optional and here is an example:
        My service manages meeting rooms and their booking by users
 What problem are you solving?: Let consumers play chess using GraphQL

 Describe how you solve it? It's optional too and should look something like:
        This service provides an API to create, update and delete rooms and
        another set of queries to manage bookings, cancellations, and search for available rooms.
 How you solve it?: Wrapping chess.js into a GraphQL endpoint

 What is the most relevant business domain of your service?
 Use up/down arrows to navigate and hit ENTER to select.
 Please select 'Other' as last option
 Business domain: Content_Management

 Now, the last thing, enter free-hashtags describing your service.
 Up to 5, comma-separated, no need to add #.
 Example:
        hospitality, booking, meeting-rooms, office
 Hashtags: games,chess,play,fun
```

You should get something like that : 

```text
✔ Created service with ID: chess-server
✔ Private and demo environment containers were built
✔ Deployed to private and demo environments
✔ Downloading service template 
Your service on private environment is available by this url: https://api.code.store/121066bcd3ae4a049a326c99639e26bc/graphql
Your service on demo environment is available by this url: https://api.code.store/858f86742a234d0b91be456a59089adb/graphql
```

## Step 2: Chess game schema

As we created our service, the first thing we need to do is to modify the default GraphQL schema by adding a new Type: Game. Players will interact with our API to play chess, games will be stored in our database. Inside your service, you'll need to edit the `/src/schema.graphql` file. 

By default, your schema looks like that :

```graphql
# This file was generated by code.store CLI and it should not be deleted.
#
# Visit our documentation to learn more about GraphQL https://docs.code.store/getting-started/graphql-schemas as well as about working with code.store https://docs.code.store/getting-started/quick-start/quick-start-with-cli
#
# In case of questions, you can send us a message at our community chat https://spectrum.chat/code-store
#
type Query {
    helloWorld: String!
}
```

Let's remove the default `helloWorld` query and add a type where we'll store chess Game states,  your schema should look like this :

```graphql
type Game {
    id: ID!                                     #Game's unique identifier
    createdAt: String!                          #Game's creation date
    fen: String                                 #Game's FEN representation 
    ascii: String                               #ASCII art representation of the board
    turn: String!                               #Current turn of the game, may be B or W
}
```

Adding a new type will generate a table and TypeOrm entity for you. What we put inside our `Game` type is open, I decided here to store a unique identifier of a game, a timestamp of when the game was created, a FEN representation string \( Forsyth–Edwards Notation, which is a kind of compressed representation of a chess game\), an ASCII textual visualization of a board and current turn \(black of white\). We could do less \(just an ID is ok\) or more \(adding the game's state, history, comments, ...\)

Let's test it immediately. Go inside your service folder and execute the following command : 

```graphql
cs generate
```

`generate` command validates your schema and, if necessary, generates database models, TypeOrm entities, and migrations. In our case, it will throw an error, because there are no queries anymore in our schema \(we removed the default `helloWorld` query\).

```graphql
cs generate
✔ Compiling your code
✖ Query root type must be provided.
◼ Preparing the service code for upload
◼ Reverting extra migrations
◼ Uploading service to the generator
◼ Saving generated code 

 ›   Error: Error: Query root type must be provided.
```

So we need to add a query to create a valid schema. One of the simplest ones would a query to load a game from the database providing its ID as parameter and returning a Game object : 

```graphql
type Game {
    id: ID!             #Game's unique identifier
    createdAt: String!  #Game's creation date
    fen: String         #Game's FEN representation 
    ascii: String       #ASCII art representation of the board
    turn: String!       #Current turn of the game, may be B or W
}

type Query {
    load(gameId: ID!): Game
}
```

  You can notice here that there is no `!` mark after the `Game`, which means our query may return `null` \(in case of the wrong `ID` for example\). Save your schema.graphql file, return to your favorite CLI, and run cs generate again. Yeehaa! You should get something like that : 

```graphql
cs generate
✔ Compiling your code
✔ Validating schema
✔ Preparing the service code for upload
↓ Migrations were not reverted: role "username" does not exist [SKIPPED]
✔ Uploading service to the generator
✔ Generated code has been saved 

```

As we started to work with stored objects, we need to setup a local database 

